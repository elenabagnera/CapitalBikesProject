---
title: "visualizations"
author: "Elena Bagnera"
date: "11/13/2021"
output: html_document
---

```{r include = FALSE}
def.chunk.hook <- knitr::knit_hooks$get("chunk")
knitr::opts_chunk$set(cache = FALSE)
knitr::knit_hooks$set(
  chunk = function(x, options) {
    x <- def.chunk.hook(x, options)
    ifelse(options$size != "normalsize", paste0("\n \\", options$size, "\n\n", x, "\n\n \\normalsize"), x)
  }
)
# knitr::knit_hooks$set(inline = function(x) {
#   prettyNum(round(x, 2), big.mark = ",")
# })
options(scipen=999)
```


\begin{center}
\Huge{PPOL 670 | Final Project}

\Huge{Visualizations}
\end{center}

\vspace{0.1in}

[GitHub](https://github.com/elenabagnera/CapitalBikesProject)

## Setup
```{r setup, message=FALSE}
library(tidyverse)
library(httr)
library(jsonlite)
source("times.R")
source("io.R")
source("manipulate_data.R")
```


[Direct link to dataset](https://s3.amazonaws.com/capitalbikeshare-data/202108-capitalbikeshare-tripdata.zip)

```{r get_data, cache=TRUE, warning=FALSE, message=FALSE}
# get data through API
url <- "https://maps2.dcgis.dc.gov/dcgis/rest/services/DCGIS_DATA/Transportation_WebMercator/MapServer/5/query?where=1%3D1&outFields=*&outSR=4326&f=json"

# 1) use the URL to make a request from the API
data_json <- GET(url = url, 
                 user_agent("Georgetown University Assignment"))
# 2) Check for a server error in the response
http_status(data_json)
# 3) get the contents of the response as a text string
data_json <- content(data_json, as = "text")
# 4) create a character matrix from the JSON
data_matrix <- fromJSON(data_json)
# 5) turn the body of the character matrix into a tibble
cbs_data <- as_tibble(data_matrix[2:nrow(data_matrix)],
                      .name_repair = "minimal")
#6) add variable names to the tibble
names(cbs_data) <- data_matrix[1, ]
#check the data form - now is data.frame
class(cbs_data)

#cbs_data <- read_files('data/')
data <- sep_departures_from_arrivals(cbs_data)
hour_data <- get_station_hourly(data)
```

## Visualizations and Explorations

Amount of rides at the Lincoln memorial over all the time, and by various metrics

```{r visualizations}
# The grouped data does not have the original date column, but it can be nice
#  for visualizations. There is a function to do this in times.R
hour_data_date <- add_date_column(hour_data)

hour_data_date %>% 
  ggplot() +
  geom_point(aes(x=date, y=lincoln_memorial, color=type))

hour_data_date %>% 
  mutate(weekday = wday(date, label=TRUE)) %>% 
  ggplot() +
  geom_point(aes(x=weekday, y=lincoln_memorial, color=type))

hour_data_date %>% 
  ggplot() +
  geom_point(aes(x=day, y=lincoln_memorial, color=type))

hour_data_date %>% 
  ggplot() +
  geom_point(aes(x=hour, y=lincoln_memorial, color=type))

hour_data_date %>% 
  filter(year == 2021, month == "Aug", day == 15) %>% 
  ggplot() +
  geom_line(aes(x=hour, y=lincoln_memorial, color=type))
```